<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calvin and Saharsh: Calvin's Wet Dream (Saharsh Edition)</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    html,body{height:100%;margin:0}
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #ffe6f2, #171721);
      color: #fdfdfd;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .game {
      background: rgba(0, 0, 0, 0.58);
      border-radius: 16px;
      max-width: 980px;
      width: 94%;
      padding: 22px 26px;
      box-shadow: 0 20px 48px rgba(0,0,0,0.55);
      backdrop-filter: blur(10px);
      display: grid;
      grid-template-columns: 1fr 320px;
      gap:16px;
    }
    @media (max-width:1000px){ .game{grid-template-columns:1fr; } .side{order:2} }
    .main {
      padding-right:8px;
    }
    .title {
      font-size: 1.6rem;
      font-weight: 800;
      margin-bottom: 4px;
    }
    .subtitle { font-size:0.92rem; opacity:0.82; margin-bottom:12px; }
    .scene-text {
      white-space: pre-line;
      line-height: 1.55;
      margin-bottom: 12px;
      font-size: 1rem;
      min-height: 240px;
      padding:14px;
      border-radius:10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      border:1px solid rgba(255,255,255,0.04);
      overflow:auto;
    }
    .choices { display:flex;flex-direction:column;gap:8px; margin-bottom:8px; }
    button.choice {
      padding:10px 14px;border-radius:999px;border:none;cursor:pointer;
      font-size:0.95rem;text-align:left;background:rgba(255,255,255,0.11);color:#fff;
      transition: background .17s, transform .06s, box-shadow .12s;
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }
    button.choice:hover { background: rgba(255,255,255,0.20); transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,0.35); }
    .meta { margin-top:8px; font-size:0.85rem; opacity:0.85; display:flex;justify-content:space-between;align-items:center;}
    .restart { padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.35);background:transparent;color:inherit;cursor:pointer;font-size:0.82rem; }
    .restart:hover{background:rgba(255,255,255,0.08)}
    .side { padding-left:8px; }
    .stat { margin-bottom:12px; background:rgba(255,255,255,0.02); padding:10px; border-radius:8px; }
    .stat h4 { margin:0 0 8px 0; font-size:0.95rem }
    .bar { height:10px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden; }
    .bar > i { display:block;height:100%;width:0%; background:linear-gradient(90deg,#ff9fcf,#8dd3ff); transition:width .4s ease; }
    .history { max-height:220px; overflow:auto; padding:8px; background:rgba(0,0,0,0.12); border-radius:8px; font-size:0.9rem; }
    .history .item { padding:6px 4px; border-bottom:1px dashed rgba(255,255,255,0.03); }
    .controls { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap }
    .ctrl { padding:6px 10px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.06); color:inherit; cursor:pointer; font-size:0.86rem; }
    .ctrl:hover{ background:rgba(255,255,255,0.03) }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; padding:4px 6px; background:rgba(255,255,255,0.02); border-radius:6px; font-weight:700; margin-left:6px; }
    .note { font-size:0.85rem; color:rgba(255,255,255,0.8); margin-top:8px; }
  </style>
</head>
<body>
  <div class="game" role="application" aria-labelledby="title">
    <div class="main">
      <div class="title" id="title">Calvin &amp; Saharsh — Advanced (Saharsh POV)</div>
      <div class="subtitle">A branching, variable-driven slice-of-life — honesty, tension, affection, and choices that matter.</div>

      <div class="scene-text" id="text" tabindex="0" aria-live="polite"></div>

      <div class="choices" id="choices" role="list"></div>

      <div class="meta">
        <div id="status">Scenes visited: 0</div>
        <div>
          <button class="restart" id="restartBtn">Restart</button>
        </div>
      </div>
    </div>

    <aside class="side" aria-hidden="false">
      <div class="stat">
        <h4>Stats</h4>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px"><div style="width:80px">Affection</div><div class="bar" style="flex:1"><i id="affBar"></i></div></div>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px"><div style="width:80px">Tension</div><div class="bar" style="flex:1"><i id="tenBar"></i></div></div>
        <div style="display:flex;gap:8px;align-items:center"><div style="width:80px">Honesty</div><div class="bar" style="flex:1"><i id="honBar"></i></div></div>
      </div>

      <div class="stat">
        <h4>Controls</h4>
        <div class="controls">
          <button class="ctrl" id="saveBtn">Save (S)</button>
          <button class="ctrl" id="loadBtn">Load (L)</button>
          <button class="ctrl" id="undoBtn">Undo (U)</button>
        </div>
        <div class="note">Choose with number keys 1–9. Save to continue another time.</div>
      </div>

      <div class="stat">
        <h4>History</h4>
        <div class="history" id="history">No choices yet.</div>
      </div>
    </aside>
  </div>

  <script>
    // Advanced story engine with variables and conditional choices
    // State
    const initialState = {
      node: "start",
      steps: 0,
      history: [],
      affection: 20, // 0..100
      tension: 8,
      honesty: 12,
      flags: {}
    };
    let state = JSON.parse(JSON.stringify(initialState));

    // Story object (Saharsh POV centered)
    const story = {
      // ACT 1 - First thread
      start: {
        text: `Years later, Saharsh will remember the tilt of the campus lamppost the night everything changed.

Sagas rarely begin with trumpet calls. They begin with ordinary things: a bottle, a laugh, a glance.
For Saharsh, it begins when he notices a constant: someone never without a drink.`,
        choices: [
          { text: "Orientation — noisy auditorium", next: "meet_orientation" },
          { text: "Library — the almost-collision", next: "meet_library" },
          { text: "Computer lab — a dry joke and a fix", next: "meet_lab" }
        ]
      },

      meet_orientation: {
        text: `The auditorium is a tide of names and nerves. Saharsh fidgets with his notebook. A guy hovers at the aisle, bottle clutched like a buoy. The name tag reads: Calvin.`,
        choices: [
          { text: "Offer the seat beside you", next: "first_thread_bold", effects:{affection:+2} },
          { text: "Stay quiet and observe", next: "first_thread_shy", effects:{honesty:+0} }
        ]
      },

      meet_library: {
        text: `Dust and coffee. Their hands meet over the same book. Calvin laughs; the sound rolls warm. He has stickered laptop and a tired grin.`,
        choices: [
          { text: "Make a joke", next: "first_thread_bold", effects:{affection:+1} },
          { text: "Let him have it, introduce yourself", next: "first_thread_shy", effects:{honesty:+1} }
        ]
      },

      meet_lab: {
        text: `Tangled cables and exasperation. Saharsh mutters a fix; Calvin grins. The joke lands like a small handshake.`,
        choices: [
          { text: "Show another trick", next: "first_thread_bold", effects:{affection:+1} },
          { text: "Step back and watch", next: "first_thread_shy", effects:{tension:+1} }
        ]
      },

      first_thread_bold: {
        text: `Names exchange. Calvin's smile is easy and makes Saharsh's chest unclench without polite reason.`,
        choices: [{ text: "Share contacts and plan to meet", next: "early_bonding", effects:{affection:+2} }]
      },

      first_thread_shy: {
        text: `The moment is soft and slow. Later, the two joke about spilled coffee and end up seated together by coincidence.`,
        choices: [{ text: "Let the friendship grow", next: "early_bonding", effects:{honesty:+1} }]
      },

      early_bonding: {
        text: `They start orbiting. Playlists. Late nights. Calvin's drink becomes a small signature Saharsh learns to notice.`,
        choices: [
          { text: "Late night study sessions", next: "bond_study", effects:{affection:+1} },
          { text: "Walks after class", next: "bond_walks", effects:{honesty:+0} },
          { text: "Group projects every term", next: "bond_projects", effects:{tension:-1} }
        ]
      },

      bond_study: {
        text: `2 AM and half a pizza: they talk and don't talk. There's a closeness that is less like a rope and more like the floor underfoot.`,
        choices: [{ text: "Enjoy the closeness", next: "year_two_start", effects:{affection:+1} }]
      },

      bond_walks: {
        text: `Walking under streetlights, they trade old secrets. Saharsh finds comfort and a small ache.`,
        choices: [{ text: "Note that ache", next: "year_two_start", effects:{honesty:+1} }]
      },

      bond_projects: {
        text: `They win a project prize. High-fives and tired jokes. Fame is small but feels like a private joke between them.`,
        choices: [{ text: "Keep going", next: "year_two_start", effects:{affection:+1} }]
      },

      // ACT 2 - Realization
      year_two_start: {
        text: `Year two settles. Habits become rituals. One evening beneath a lamp, words get heavy.`,
        choices: [
          { text: "Tell him a true thing", next: "year_two_vulnerable", effects:{honesty:+1} },
          { text: "Skirt the truth", next: "year_two_light", effects:{tension:+1} }
        ]
      },

      year_two_vulnerable: {
        text: `He unmasks exhaustion and fear. Calvin listens like people who know how to hold a heavy thing.`,
        choices: [{ text: "Feel strangely safe", next: "realization", effects:{affection:+2} }]
      },

      year_two_light: {
        text: `He jokes it away. Calvin notices and nudges gently. Presence, not words, matters.`,
        choices: [{ text: "Appreciate the presence", next: "realization", effects:{honesty:+0} }]
      },

      realization: {
        text: `It arrives in fragments: a laugh meant for him, a text that brightens noon. Saharsh realizes his feelings tip over into something harder to name.`,
        choices: [
          { text: "Ignore it and act normal", next: "year_three_start", effects:{honesty:-1} },
          { text: "Plan to tell him someday", next: "year_three_start", effects:{honesty:+1,affection:+1} },
          { text: "Quietly enjoy it", next: "year_three_start" }
        ]
      },

      // ACT 3 - Distance & doubt
      year_three_start: {
        text: `The world changes fast: internships, plans. Messages go unanswered. The easy rhythm frays.`,
        choices: [
          { text: "Reach out more", next: "year_three_reach", effects:{affection:+1} },
          { text: "Give space and hope", next: "year_three_drift", effects:{tension:+1} }
        ]
      },

      year_three_reach: {
        text: `He sends memes, coffee invites. Responses are uneven. The worry grows.`,
        choices: [{ text: "Push for talk — risk sounding needy", next: "year_three_argument_soft", effects:{tension:+1} }]
      },

      year_three_drift: {
        text: `He withdraws. Distance tastes like cotton and regret.`,
        choices: [{ text: "Let the silence build", next: "year_three_argument_sharp", effects:{tension:+2} }]
      },

      year_three_argument_soft: {
        text: `"I feel invisible," one admits softly. Hurt is more exhausting than anger; they land in a tender repair.`,
        choices: [{ text: "Talk all night", next: "year_three_night_talk", effects:{honesty:+1} }]
      },

      year_three_argument_sharp: {
        text: `An old crack opens: 'You're always busy', 'You pulled away'. Sharp words cut. Then they both want to repair.`,
        choices: [{ text: "Have the full talk tonight", next: "year_three_night_talk", effects:{honesty:+1,tension:-1} }]
      },

      year_three_night_talk: {
        text: `They talk in the muted small hours. An almost-sentence hovers: 'I'm in love...' Saharsh swallows. Calvin offers time: 'When you're ready, tell me.'`,
        choices: [{ text: "Hold that invitation", next: "year_four_start", effects:{honesty:+1} }]
      },

      // ACT 4 - Choice & urgency
      year_four_start: {
        text: `Final year is a countdown. Offers, moves, decisions. Calvin mentions possibly leaving abroad. The 'later' becomes impossible.`,
        choices: [
          { text: "Decide to tell him now", next: "year_four_now", effects:{tension:+1} },
          { text: "Promise to wait for stability", next: "year_four_wait", effects:{honesty:-1} }
        ]
      },

      year_four_now: {
        text: `He decides: no more 'someday'. He plans a rooftop or a cafe or a letter.`,
        choices: [
          { text: "Rooftop under the stars", next: "rooftop_plan", effects:{affection:+1} },
          { text: "Same cafe they always go", next: "cafe_plan" },
          { text: "Write the letter and fold courage", next: "letter_plan" }
        ]
      },

      year_four_wait: {
        text: `He says 'later' and the world moves quicker than the word. Calvin's move happens sooner than expected.`,
        choices: [{ text: "Panic and act now", next: "year_four_push", effects:{tension:+2} }]
      },

      year_four_push: {
        text: `Time shrinks. He scrambles. No perfect moment—only this one.`,
        choices: [
          { text: "Ask to meet and say it", next: "rooftop_plan", effects:{honesty:+1} },
          { text: "Deliver the letter now", next: "letter_give" }
        ]
      },

      // confession scenes
      rooftop_plan: {
        text: `Rooftop. City like pinpricks. Two drinks on the ledge. He breathes and starts small.`,
        choices: [
          { text: "Weave confession into memory", next: "rooftop_confess_soft" },
          { text: "Say it plainly", next: "rooftop_confess_direct" }
        ]
      },

      cafe_plan: {
        text: `Corner cafe, steam and low chatter. Familiarity makes truth less hostile.`,
        choices: [
          { text: "Gently, through 'remember when'", next: "cafe_confess_soft" },
          { text: "Playful then real", next: "cafe_confess_playful" }
        ]
      },

      letter_plan: {
        text: `The letter is perfect and imprecise. Folding it is both courage and exile.`,
        choices: [
          { text: "Give it in person", next: "letter_give" },
          { text: "Send after he boards", next: "letter_late" }
        ]
      },

      rooftop_confess_soft: {
        text: `He remembers everything: the long walks, the late nights, the tiny kindnesses. "Somewhere along the way, I stopped thinking of you as just a friend," he says. "I love you."`,
        choices: [{ text: "Wait for Calvin", next: "reaction_core" }]
      },

      rooftop_confess_direct: {
        text: `"I'm in love with you," he says plain. The city seems to pause. Calvin looks as if he had been clutching the same sentence and finally let it out.`,
        choices: [{ text: "Stay still and listen", next: "reaction_core" }]
      },

      cafe_confess_soft: {
        text: `He tells the story of how the small things stacked until they became everything. Calvin's face shifts; the air tilts.`,
        choices: [{ text: "Let silence do the work", next: "reaction_core" }]
      },

      cafe_confess_playful: {
        text: `A joke peels the edge away. Then he drops the punchline: it's real. Calvin stops laughing, and something honest arrives.`,
        choices: [{ text: "Watch his expression", next: "reaction_playful" }]
      },

      letter_give: {
        text: `He hands the papers. Calvin reads and takes a slow breath: "I had no idea you felt all that and I'm sorry I made you wait."`,
        choices: [{ text: "Ask to call and say it", next: "deepen" }]
      },

      letter_late: {
        text: `The plane leaves with his words inside. Distance is its own test. The reply comes later: "We need to talk."`,
        choices: [{ text: "Choose long-distance honesty", next: "epilogue_long_distance" }]
      },

      // reactions & deepen
      reaction_core: {
        text: `Calvin's laugh breaks into tears. "I thought it was just me," he says. They both exhale like something heavy lifted.`,
        choices: [{ text: "Let this be a beginning", next: "deepen", effects:{affection:+3,honesty:+2} }]
      },

      reaction_playful: {
        text: `Calvin's mockery softens. "You dramatic idiot," he says. "I love you too." They both smile like it's a small miracle.`,
        choices: [{ text: "Hold onto it", next: "deepen", effects:{affection:+3} }]
      },

      deepen: {
        text: `They build small rituals: playlists titled 'us', nightly check-ins, honest conversations about fear. Not perfect, but intentional.`,
        choices: [
          { text: "Stay together and keep showing up", next: "epilogue_together" },
          { text: "Choose distance but with rules", next: "epilogue_long_distance" }
        ]
      },

      // Epilogues
      epilogue_together: {
        text: `They choose each other. Years later they'll remember arguing about pizza toppings and how their first honest night felt like a door opening.`,
        choices: [{ text: "Restart", next: "start" }]
      },

      epilogue_long_distance: {
        text: `They navigate timezones with rituals: voice notes, surprise visits, playlists. Long-distance is a language they learn to speak.`,
        choices: [
          { text: "Plan a reunion", next: "epilogue_reunion" },
          { text: "Restart", next: "start" }
        ]
      },

      epilogue_reunion: {
        text: `A station smell of coffee and luggage. They run into each other's arms. It's messy and perfect.`,
        choices: [{ text: "Hold this", next: "epilogue_together" }]
      },

      // Tension / heartbreak path
      breakup_path: {
        text: `Words left unsaid calcify. Misunderstandings pile up. One day distance feels like a chasm.`,
        choices: [{ text: "Try to bridge", next: "attempt_bridge"}, { text: "Let the story end here", next: "epilogue_bittersweet"}]
      },

      attempt_bridge: {
        text: `One last attempt: calls, apologies, therapy. The result is messy but honest.`,
        choices: [{ text: "Accept imperfect repair", next: "epilogue_together"}, { text: "Separate and keep fondness", next: "epilogue_bittersweet"}]
      },

      epilogue_bittersweet: {
        text: `They keep what was good—memories and small rituals—but timing and fear mean it's not the life they dreamed. There's tenderness and ache.`,
        choices: [{ text: "Restart", next: "start" }]
      },

      // secret / true ending conditionally available
      secret_true: {
        text: `After many honest choices — naming things aloud, refusing to leave, saying the old names — the fracture calms in a way that feels like healing rather than sealing.`,
        choices: [{ text: "Live the healed life", next: "epilogue_together" }]
      }
    };

    // Utility functions for condition/effects and rendering
    function clamp(n,min=0,max=100){ return Math.max(min,Math.min(max,n)); }

    function applyEffects(effects){
      if(!effects) return;
      if(effects.affection) state.affection = clamp(state.affection + effects.affection);
      if(effects.tension) state.tension = clamp(state.tension + effects.tension);
      if(effects.honesty) state.honesty = clamp(state.honesty + effects.honesty);
      if(effects.flag) state.flags[effects.flag.key] = effects.flag.value;
    }

    function checkCondition(cond){
      if(!cond) return true;
      // cond may be a function or object
      if(typeof cond === 'function') return cond(state);
      if(typeof cond === 'object'){
        return Object.entries(cond).every(([k,expr])=>{
          const val = state[k] || 0;
          if(typeof expr === 'number') return val >= expr;
          const m = /^([<>=!]+)\s*(\d+)$/.exec(expr);
          if(!m) return true;
          const op = m[1], cmp = Number(m[2]);
          switch(op){
            case '>=': return val >= cmp;
            case '<=': return val <= cmp;
            case '>': return val > cmp;
            case '<': return val < cmp;
            case '==': return val == cmp;
            case '!=': return val != cmp;
            default: return true;
          }
        });
      }
      return true;
    }

    // render
    const textEl = document.getElementById('text');
    const choicesEl = document.getElementById('choices');
    const statusEl = document.getElementById('status');
    const historyEl = document.getElementById('history');
    const affBar = document.getElementById('affBar');
    const tenBar = document.getElementById('tenBar');
    const honBar = document.getElementById('honBar');

    let undoStack = [];

    function renderNode(key){
      const node = story[key];
      if(!node) return;
      state.node = key;
      state.steps++;
      // update history
      historyAdd(`Entered: ${key.replace(/_/g,' ')}`);
      // render text
      textEl.textContent = node.text.replace(/\{affection\}/g, state.affection).replace(/\{tension\}/g, state.tension).replace(/\{honesty\}/g, state.honesty);
      // render choices
      choicesEl.innerHTML = '';
      const available = (node.choices || []).filter(c => checkCondition(c.condition));
      if(available.length === 0){
        const btn = document.createElement('button'); btn.className='choice'; btn.textContent='Continue'; btn.onclick=()=> choose({next:'start'}); choicesEl.appendChild(btn);
      } else {
        available.forEach((choice, idx) => {
          const btn = document.createElement('button'); btn.className='choice'; btn.textContent = ` ${choice.text}`; btn.onclick = ()=> choose(choice);
          btn.setAttribute('data-index', idx+1);
          choicesEl.appendChild(btn);
        });
      }
      // update status and bars
      statusEl.textContent = `Scenes visited: ${state.steps}`;
      affBar.style.width = state.affection + '%';
      tenBar.style.width = state.tension + '%';
      honBar.style.width = state.honesty + '%';
      saveAuto(); // lightweight auto-save
    }

    function choose(choice){
      // push undo snapshot
      undoStack.push(JSON.parse(JSON.stringify(state)));
      // apply effects then go to next
      applyEffects(choice.effects);
      // special: secret true ending unlock condition
      if(state.affection >= 85 && state.honesty >= 60 && state.tension <= 25 && story['secret_true']){
        // if unlocked, prefer secret_true if route suggests
        if(choice.next === 'epilogue_together') { renderNode('secret_true'); return; }
      }
      renderNode(choice.next);
    }

    function historyAdd(txt){
      state.history.push({step: state.steps, txt, t: Date.now()});
      // keep last 50
      if(state.history.length > 80) state.history.shift();
      updateHistoryUI();
    }
    function updateHistoryUI(){
      historyEl.innerHTML = '';
      if(state.history.length === 0){ historyEl.textContent = 'No choices yet.'; return;}
      state.history.slice().reverse().forEach(h => {
        const d = document.createElement('div'); d.className='item'; d.textContent = h.txt; historyEl.appendChild(d);
      });
    }

    // Save / Load
    const SAVE_KEY = 'sasa_advanced_save_v1';
    function saveGame(){
      try{
        const payload = { state };
        localStorage.setItem(SAVE_KEY, JSON.stringify(payload));
        statusFlash('Saved');
      }catch(e){ console.warn("save failed",e); statusFlash('Save failed'); }
    }
    function loadGame(){
      try{
        const raw = localStorage.getItem(SAVE_KEY);
        if(!raw) { statusFlash('No save found'); return; }
        const payload = JSON.parse(raw);
        state = payload.state;
        // ensure history UI and bars update
        updateHistoryUI();
        renderNode(state.node || 'start');
        statusFlash('Loaded');
      }catch(e){ console.warn("load failed",e); statusFlash('Load failed'); }
    }

    function saveAuto(){
      // small silent auto-save of important fields (not full undo stack)
      try{
        const minimal = { node: state.node, steps: state.steps, affection: state.affection, tension: state.tension, honesty: state.honesty, flags: state.flags, history: state.history.slice(-20) };
        localStorage.setItem(SAVE_KEY + '_auto', JSON.stringify(minimal));
      }catch(e){}
    }

    // Undo
    function undo(){
      if(undoStack.length === 0){ statusFlash('Nothing to undo'); return; }
      const prev = undoStack.pop();
      state = prev;
      updateHistoryUI();
      renderNode(state.node);
      statusFlash('Undo');
    }

    // small status flash
    function statusFlash(msg){
      const prev = statusEl.textContent;
      statusEl.textContent = msg;
      setTimeout(()=> statusEl.textContent = prev, 1200);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if(e.key >= '1' && e.key <= '9'){
        const idx = Number(e.key) - 1;
        const list = Array.from(choicesEl.querySelectorAll('button.choice'));
        if(list[idx]) list[idx].click();
      }
      if(e.key === 's') saveGame();
      if(e.key === 'l') loadGame();
      if(e.key === 'u') undo();
    });

    // Buttons
    document.getElementById('restartBtn').addEventListener('click', ()=>{
      if(!confirm('Restart the story? Progress will be lost (you can load a save).')) return;
      state = JSON.parse(JSON.stringify(initialState));
      undoStack = [];
      renderNode('start');
    });
    document.getElementById('saveBtn').addEventListener('click', saveGame);
    document.getElementById('loadBtn').addEventListener('click', loadGame);
    document.getElementById('undoBtn').addEventListener('click', undo);

    // Initialize UI
    renderNode(state.node);

    // Expose for debugging (optional)
    window.sasa = { state, story, saveGame, loadGame, undo, renderNode };

  </script>
</body>
</html>
